!function(a,b){"use strict";a.maoApp=b.module("maoApp",["ngSanitize"])}(window,window.angular),function(a){"use strict";a.controller("ApplicationController",["$scope",function(a){a.filtersOpen=!0,a.modalOpen=!1,a.keyUp=function(b){27===b.keyCode&&a.$broadcast("modal/close")}}])}(window.maoApp),function(a){"use strict";a.controller("FiltersController",["$scope","gateway","http",function(a,b,c){a.name="",a.price={percentage:{minimum:0,maximum:100},actual:{minimum:0,maximum:0}},a.filters={colours:{models:[],selected:[]},manufacturers:{models:[],selected:[]}},a.setName=b.setName,c.getAttribute("color").then(function(b){a.filters.colours.models=b,a.$broadcast("filters/received","colour")}),c.getAttribute("manufacturer").then(function(b){a.filters.manufacturers.models=b,a.$broadcast("filters/received","manufacturer")}),a.resetName=function(){a.name="",a.setName(a.name)},a.resetPriceRange=function(){a.price.percentage={minimum:0,maximum:100},a.price.actual={minimum:0,maximum:0};var c=a.immutableStatistics.ranges.price.min,d=a.immutableStatistics.ranges.price.max;b.setPriceRange(c,d+.001)},a.invertColours=function(){_.forEach(a.filters.colours.selected,function(b,c){a.filters.colours.selected[c]=!a.filters.colours.selected[c]}),a.setColour()},a.invertManufacturers=function(){_.forEach(a.filters.manufacturers.selected,function(b,c){a.filters.manufacturers.selected[c]=!a.filters.manufacturers.selected[c]}),a.setManufacturer()},a.setPriceRange=function(c,d,e){a.price.actual.minimum=d=a.immutableStatistics.ranges.price.max/100*d,a.price.actual.maximum=e=a.immutableStatistics.ranges.price.max/100*e,d>e&&("maximum"===c?a.price.percentage.minimum=a.price.percentage.maximum:a.price.percentage.maximum=a.price.percentage.minimum),b.setPriceRange(d,e+.001)},a.setColour=function(){var c=[];_.forEach(a.filters.colours.selected,function(a,b){a&&c.push(b)}),b.setColour(c)},a.setManufacturer=function(){var c=[];_.forEach(a.filters.manufacturers.selected,function(a,b){a&&c.push(b)}),b.setManufacturer(c)},a.open=function(){a.$parent.filtersOpen=!0},a.close=function(){a.$parent.filtersOpen=!1}}])}(window.maoApp),function(a){"use strict";a.controller("ModalController",["$scope",function(a){a.options={},a.partial="",a.$on("modal/open",function(b,c,d){a.partial="views/"+c,a.options=d}),a.$on("modal/close",function(){a.close()}),a.close=function(){a.$parent.modalOpen=!1,a.partial="",a.options={}}}])}(window.maoApp),function(a){"use strict";a.controller("ProductController",["$scope","http",function(a,b){a.addBasket=function(a){b.addBasket(a).then(function(a){return a})}}])}(window.maoApp),function(a){"use strict";a.controller("ProductsController",["$scope","$rootScope","socket","gateway","http",function(a,b,c,d,e){a.products=[],a.sorting={property:"name",direction:"asc"},a.statistics={},a.immutableStatistics=null,a.view=function(c,d){d&&d.stopPropagation(),a.modalOpen=!0,e.getProduct(c).then(function(a){b.$broadcast("modal/open","product.html",{model:a.data})})},a.closeModal=function(){a.modalOpen&&b.$broadcast("modal/close")},a.setSorting=function(b){a.sorting.property===b&&(a.sorting.direction="asc"===a.sorting.direction?"desc":"asc"),a.sorting.property=b,c.node.emit("snapshot/products/sortBy",a.sorting.property,a.sorting.direction)},c.node.on("snapshot/products/contentUpdated",function(b,c){a.$apply(function(){a.statistics=c,a.products=d.resolve(b),a.immutableStatistics||(a.immutableStatistics=a.statistics)})}),a.nextPage=function(){c.node.emit("snapshot/products/pageNumber",a.statistics.pages.current+1)},a.previousPage=function(){c.node.emit("snapshot/products/pageNumber",a.statistics.pages.current-1)}}])}(window.maoApp),function(a){"use strict";a.directive("accordionGroup",function(){return{restrict:"A",controller:["$scope",function(a){a.activeScope={},a.setActive=function(b){a.$apply(function(){return a.activeScope===b?(a.activeScope={},void 0):(a.activeScope=b,void 0)})}}]}}),a.directive("accordionItem",["$timeout",function(a){return{restrict:"A",scope:!0,link:function(b,c){b.$on("filters/received",function(){a(function(){c.css("height","auto"),b.height=c.height(),c.css("height",32)},1)}),c.find("h2").bind("click",function(){b.setActive(b)}),b.$watch("activeScope",function(a){return a!==b?(c.css("height",32),void 0):(c.css("height",b.height),void 0)})}}}])}(window.maoApp),function(a){"use strict";a.directive("sidebar",["$window",function(a){return{restrict:"A",link:function(b,c){angular.element(a).bind("scroll",function(){var b=50-a.scrollY,d=0>b?0:b;c[0].style.top=d+"px"})}}}])}(window.maoApp),function(a){"use strict";a.service("gateway",["socket",function(a){var b={};return b._productsCache={},b.primaryKey="id",b.resolve=function(a){var c=[];return _.forEach(a,function(a){if(!_.isNumber(a)){var d=a[b.primaryKey];return b._productsCache[d]=a,c.push(a),void 0}c.push(b._productsCache[a])}),c},b.setPriceRange=function(b,c){a.node.emit("snapshot/products/rangeFilter","price",[b,c])},b.setName=function(b){a.node.emit("snapshot/products/fuzzyFilter","name",b)},b.setColour=function(b){a.node.emit("snapshot/products/colours",b)},b.setManufacturer=function(b){a.node.emit("snapshot/products/manufacturers",b)},b}])}(window.maoApp),function(a){"use strict";a.service("http",["$q","$http",function(a,b){var c={};return c.url="../api/public/",c.getAttribute=function(d){var e=a.defer();return b.get(c.url+"attributes/"+d).then(function(a){e.resolve(a.data)}),e.promise},c.getProduct=function(a){return b.get(c.url+"product/"+a)},c.addBasket=function(a){return b.get(c.url+"basket/add/"+a)},c}])}(window.maoApp),function(a){"use strict";a.service("socket",["$window",function(a){var b={};return b.url="http://localhost:8888/",b._getSocket=function(){return a.io},b.connect=function(a){return b._getSocket().connect(a)},b.node=b.connect(b.url),b}])}(window.maoApp);