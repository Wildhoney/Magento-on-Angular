/*! Mao by Adam Timberlake created on 2013-09-07 */
!function(a){"use strict";a.mao=angular.module("maoApp",[]).config(["$routeProvider","$provide","$locationProvider",function(a,b,c){a.when("/",{templateUrl:"views/home.html"}).when("/category/:category",{templateUrl:"views/category.html"}).when("/category/:category/:subCategory",{templateUrl:"views/category.html"}).when("/category/:category/:subCategory/:pageNumber",{templateUrl:"views/category.html"}).when("/product/:ident",{templateUrl:"views/product.html"}).otherwise({redirectTo:"/error/not-found"}),c.html5Mode(!1).hashPrefix("!")}])}(window),function(a){"use strict";a.factory("$attributeHelper",["$rootScope","$http","$q",function(a,b,c){var d={};d.manufacturers={url:"/Magento-on-Angular/api/public/attributes/manufacturer",defer:c.defer(),cache:[],inactive:[]},d.colours={url:"/Magento-on-Angular/api/public/attributes/color",defer:c.defer(),cache:[],inactive:[]},d.request=function f(a,c,d){var f=b({method:"GET",url:a});f.success(function(a){d(a),c.resolve(a)})},a.$on("contentUpdated",function(a,b){d.hasLoaded("colours").then(function(){d.colours.cache.forEach(function(a){a._meta.modelCount=b.filter(function(b){return b.colour===a.id}).length})}),d.hasLoaded("manufacturers").then(function(){d.manufacturers.cache.forEach(function(a){a._meta.modelCount=b.filter(function(b){return b.manufacturer===a.id}).length})})});var e=function(a,b){a.forEach(function(a){a._meta={};for(var c in b)b.hasOwnProperty(c)&&(a._meta[c]=b[c])})};return d.request(d.colours.url,d.colours.defer,function(a){e(a,{type:"colours",active:!1,modelCount:0}),d.colours.cache=a}),d.request(d.manufacturers.url,d.manufacturers.defer,function(a){e(a,{type:"manufacturers",active:!1,modelCount:0}),d.manufacturers.cache=a}),d.getColours=function(){return d.colours.cache},d.getManufacturers=function(){return d.manufacturers.cache},d.hasLoaded=function(a){return d[a].defer.promise},d.toggle=function(b){var c=d[b._meta.type],e=c.inactive.indexOf(b.id),f=-1!==e;return f?(c.inactive.splice(e,1),b._meta.active=!1):(c.inactive.push(b.id),b._meta.active=!0),a.$broadcast("attributeUpdated",b._meta.type,c.inactive),!0},d}])}(window.mao,window.jQuery),function(a){"use strict";a.factory("$categoryHelper",["$rootScope","$q",function(a,b){var c={},d=b.defer();return c.hasLoaded=function(){return d.promise},c.find=function(a,b){var d=c.categories.filter(function(b){return b.ident===a})[0];if(b)var e=d.children.filter(function(a){return a.ident===b})[0];return{category:d,subCategory:e}},a.$on("loadedCategories",function(a,b){c.categories=b,d.resolve()}),c}])}(window.mao,window.jQuery),function(a){"use strict";a.factory("$crossfilterHelper",["$rootScope",function(){var a={};return a.crossfilter={},a.dimensions=[],a.create=function(b){return a.crossfilter=crossfilter(b)},a.addDimension=function(b,c){return a.dimensions[b]=a.crossfilter.dimension(function(a){return a[c]})},a.get=function(b){return a.dimensions[b]},a}])}(window.mao,window.jQuery,window.crossfilter),function(a,b){"use strict";a.factory("$productHelper",["$rootScope","$crossfilterHelper","$http","$q",function(a,c,d,e){var f="name",g={};g.products=[],g.loaded=!1;var h=d({method:"GET",url:"/Magento-on-Angular/api/public/products"}),i=e.defer();h.success(function(a){c.create(a),c.addDimension("id","id"),c.addDimension("name","name"),c.addDimension("price","price"),c.addDimension("categories","categories"),c.addDimension("colours","colour"),c.addDimension("manufacturers","manufacturer"),i.resolve(),g.loaded=!0}),a.$on("attributeUpdated",function(d,e,f){var h=c.get(e);h.filterFunction(function(a){return-1===b.inArray(a,f)}),a.$broadcast("contentUpdated",g.getProducts())}),g.sortBy=function(b){return f=b,a.$broadcast("contentUpdated",g.getProducts()),!0},g.hasLoaded=function(){return i.promise},g.getProducts=function(){return c.get(f).top(1/0).reverse()};var j=function(b,d){var e=c.get(b);e&&(d.apply(e),a.$broadcast("contentUpdated",g.getProducts()))};return g.setQuery=function(a){if(!a)return j("name",function(){this.filterAll()}),void 0;var b=new RegExp(a,"i");j("name",function(){this.filterFunction(function(a){return a.match(b)})})},g.setCategoryId=function(a){j("categories",function(){this.filterFunction(function(c){return-1!==b.inArray(a,c)})})},g}])}(window.mao,window.jQuery),function(a){"use strict";a.controller("CategoriesController",["$scope","$http",function(a,b){a.categories=[];var c=b({method:"GET",url:"/Magento-on-Angular/api/public/categories"});c.success(function(b){a.categories=b,a.$emit("loadedCategories",b)})}])}(window.mao),function(a){"use strict";a.controller("CategoryController",["$scope","$routeParams","$categoryHelper","$productHelper","$attributeHelper",function(a,b,c,d,e){a.products=[],a.colours=[],a.manufacturers=[],a.query="",a.manufacturersFilter="",a.toggle=e.toggle,a.sortBy=d.sortBy,a.$on("contentUpdated",function(b,c){a.products=c}),a.$watch("query",function(){d.setQuery(a.query)}),c.hasLoaded().then(function(){var f=b.subCategory||null,g=c.find(b.category,f);a.category=g.category,a.subCategory=g.subCategory;var h=a.subCategory?a.subCategory.id:a.category.id;d.hasLoaded().then(function(){d.setCategoryId(h),a.products=d.getProducts()}),e.hasLoaded("colours").then(function(){a.colours=e.getColours()}),e.hasLoaded("manufacturers").then(function(){a.manufacturers=e.getManufacturers()})})}])}(window.mao),function(a){"use strict";a.controller("HomeController",function(){})}(window.mao);